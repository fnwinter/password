<!DOCTYPE html>
<html>
<head>
    <title>Password Manager</title>
    <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
    <style>
        #loading { outline: none; border: none; background: transparent }
    </style>
    <script type="module">
        const loading = document.getElementById('loading');
        addEventListener('py:ready', () => loading.close());
        loading.showModal();
    </script>
</head>
<body>
    <h2>Password Manager</h2>
    <dialog id="loading">
        <h1>Loading...</h1>
    </dialog>
    
    <div id="site_info">
    </div>

     <div id="new_site">
         <button onclick="addNewSite()">Add Site</button>
     </div>
     
     <div id="get_url">
         <h3>Get URL</h3>
         <div>
             <label>Full URL:<br><textarea id="fullUrlInput" placeholder="Enter full URL" rows="10" cols="100"></textarea></label>
         </div>
         <div>
             <label>Master Password: <input type="password" id="masterPasswordInput" placeholder="Enter master password"></label>
         </div>
         <div>
             <label>Confirm Master Password: <input type="password" id="confirmMasterPasswordInput" placeholder="Confirm master password"></label>
         </div>
         <div>
             <button onclick="generateUrl()">Generate URL</button>
             <button onclick="copyToClipboard()">Copy to Clipboard</button>
             <div id="call_python"></div>
         </div>
     </div>
    
    <script>
        // Global variables
        let allSites = [];
        
        function addNewSite() {
            const newSiteDiv = document.getElementById('site_info');
            const siteCount = newSiteDiv.children.length;
            
            const newDiv = document.createElement('div');
            newDiv.innerHTML = `
                <label>Site: <input type="text" id="siteInput${siteCount}" placeholder="Enter site name or url" size="30"></label>
                <label>Password: <input type="password" id="passwordInput${siteCount}" placeholder="Enter password"></label>
                <button onclick="togglePasswordById('passwordInput${siteCount}')">Show/Hide</button>
                <button onclick="generatePasswordById('passwordInput${siteCount}')">Generate</button>
            `;
            
            newSiteDiv.appendChild(newDiv);
        }
        
        function togglePasswordById(inputId) {
            const passwordInput = document.getElementById(inputId);
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
            } else {
                passwordInput.type = 'password';
            }
        }
        
        function generatePasswordById(inputId) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById(inputId).value = password;
        }

        function generateUrl() {
            const fullUrl = document.getElementById('fullUrlInput').value;
            const masterPassword = document.getElementById('masterPasswordInput').value;
            const confirmMasterPassword = document.getElementById('confirmMasterPasswordInput').value;
            
            if (!masterPassword || !confirmMasterPassword) {
                alert('Please enter both master password fields');
                return;
            }
            
            if (masterPassword !== confirmMasterPassword) {
                alert('Master passwords do not match');
                return;
            }
            
            try {
                const siteInfo = document.getElementById('site_info');
                
                for (let i = 0; i < siteInfo.children.length; i++) {
                    const siteInput = document.getElementById(`siteInput${i}`);
                    const passwordInput = document.getElementById(`passwordInput${i}`);
                    
                    if (siteInput && passwordInput && siteInput.value.trim() !== '') {
                        allSites.push({
                            site: siteInput.value,
                            password: passwordInput.value
                        });
                    }
                }

                document.getElementById('call_python').value = JSON.stringify(allSites);

            } catch (error) {
                alert('Invalid URL format');
            }

            
            const callPython = document.getElementById('call_python');
            callPython.click("1234","1234","1234");
        }

        function callPython(function_name, param1, param2, param3) {
            
        }

        window.onload = function() {
            addNewSite();
        }

    </script>

    <script type="py" src="./password.py" config="./password.toml"></script>
</body>
</html>
